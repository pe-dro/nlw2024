<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Enquete</title>
    <!-- Integração com Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="stylesheet" href="/public/style.css">

</head>

<body class="h-100">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="container">
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="white" width="45px">
                    <path
                        d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM160 368c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v128zm96 0c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v224zm96 0c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v64z" />
                </svg>
                <h1 class="mt-3">Crie sua enquete</h1>
            </div>
    
    
            <div>
                <form id="pollForm" action="/polls" method="POST">
                    <div class="mb-3 mt-5">
                        <label for="title" class="form-label">Título</label>
                        <input type="text" id="title" name="title" class="form-control">
                    </div>
                    <div id="optionsContainer" class="mb-3">
                        <label class="form-label" for="option1">Opção 1</label>
                        <div class="input-group">
                            <input type="text" id="option1" class="option form-control mb-3" name="options">
                        </div>
                        <label class="form-label" for="option2">Opção 2</label>
                        <div class="input-group">
                            <input type="text" id="option2" class="option form-control mb-3" name="options">
                        </div>
                        <label class="form-label" for="option3">Opção 3</label>
                        <div class="input-group">
                            <input type="text" id="option3" class="option form-control mb-3" name="options">
                        </div>
                    </div>
                    </div>
    
                    
          
            <div class="row mt-5">
                <div class="col">
                    <button type="button" class="btn btn-outline-secondary w-100" onclick="addOption()"
                        id="addOptions">Adicionar Opção</button>
                </div>
                <div class="col">
                    <button type="submit" class="btn btn-primary w-100">Enviar</button>
                </div>
            </div>
            </form>
        </div>
        </div>        
    </div>

    <script>
     
        function addOption() {         
            const optionsContainer = document.getElementById('optionsContainer');
            const optionInputs = optionsContainer.querySelectorAll('.option');
            const optionCount = optionInputs.length + 1;

            if (optionCount <= 5) {
                const newOptionLabel = document.createElement('label');
                newOptionLabel.setAttribute('for', `option${optionCount}`);
                newOptionLabel.textContent = `Opção ${optionCount}:`;
                newOptionLabel.setAttribute('class', 'mt-3');
                optionsContainer.appendChild(newOptionLabel);

                const newOptionInput = document.createElement('input');
                newOptionInput.setAttribute('type', 'text');
                newOptionInput.setAttribute('class', 'option form-control');
                newOptionInput.setAttribute('id', `option${optionCount}`);
                newOptionInput.setAttribute('name', 'options');
                optionsContainer.appendChild(newOptionInput);

            }

            if (optionCount >= 5) {
                document.getElementById('addOptions').setAttribute('disabled', 'true');
            }
        }

        document.getElementById('pollForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = {
                title: document.getElementById('title').value,
                options: Array.from(document.querySelectorAll('.option')).map(input => input.value)
            };

            fetch('/polls', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.pollId) {
                        window.location.href = `/id/${data.pollId}`;
                    } else {
                        alert("Ocorreu um erro ao enviar os dados.");
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert("Ocorreu um erro ao enviar os dados.");
                });
        });
    </script>
</body>

</html>