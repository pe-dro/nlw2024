<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= poll.title %>
    </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        

    <link rel="stylesheet" href="/public/style.css">

</head>

<body class="h-100">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="container">
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="white" width="45px">
                    <path
                        d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM160 368c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v128zm96 0c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v224zm96 0c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v64z" />
                </svg>
                <h1 class="mt-3">
                    <%= poll.title %>
                </h1>
            </div>


            <% 
var totalVotes = poll.options.reduce(function(acc, option) {
    return acc + option.score;
}, 0);
%>

<% poll.options.forEach(function(option) { %>
    <div class="mb-4">
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="" id="" value="checkedValue">
                <%= option.title %>
            </label>
        </div>
        <div class="score" data-id="<%= option.id %>">
            <%= option.score %>
            <div class="bar-container">
                <div class="bar" style="width: <%= (option.score / totalVotes) * 100 %>%;"></div>
            </div>
        </div>
    </div>
<% }); %>
            

        </div>
    </div>
    </div>

    <script>
        // Usando JSON.stringify para converter o objeto poll em uma string JSON
        var pollData = <%- JSON.stringify(poll) %>;
        console.log('Dados da pesquisa:', pollData);

        var socket = new WebSocket(`ws://${window.location.host}/polls/${window.location.href.split('/').pop()}/results`);

        // Lidar com a abertura da conexão WebSocket
        socket.onopen = function (event) {
            console.log('Conexão WebSocket aberta.');
        };

        // Lidar com a recepção de mensagens WebSocket
        socket.onmessage = function (event) {
            console.log('Mensagem recebida:', event.data);

            var newData = JSON.parse(event.data);
            var scoreElement = document.querySelector(`.score[data-id="${newData.pollOptionId}"]`);
            scoreElement.innerHTML = newData.votes;

        };

        // Lidar com o fechamento da conexão WebSocket
        socket.onclose = function (event) {
            console.log('Conexão WebSocket fechada.');
        };

        // Lidar com erros WebSocket
        socket.onerror = function (error) {
            console.error('Erro na conexão WebSocket:', error);
        };
    </script>

</body>

</html>